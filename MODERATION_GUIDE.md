# Инструкция по добавлению модератора

## Что было добавлено:

### 1. Роль модератора
- Добавлена роль `Moderator` (значение 3) в enum `ParticipantRole`
- Модераторы могут просматривать и модерировать доклады

### 2. Статус докладов
Добавлен enum `PresentationStatus`:
- **Pending (1)** - Ожидает модерации (по умолчанию)
- **Approved (2)** - Одобрен
- **Rejected (3)** - Отклонен

### 3. Поля модерации в таблице Presentations
- `Status` - статус доклада
- `ModeratedBy` - ID модератора
- `ModerationDate` - дата модерации
- `ModerationComment` - комментарий модератора (до 500 символов)

### 4. API Endpoints

#### **GET /api/moderation/pending**
Получить доклады, ожидающие модерации

#### **GET /api/moderation/all**
Получить все доклады для модерации

#### **POST /api/moderation/moderate?moderatorId={id}**
Модерировать доклад

**Request Body:**
```json
{
  "presentationId": 1,
  "status": 2,  // 2 = Approved, 3 = Rejected
  "comment": "Комментарий модератора"
}
```

#### **GET /api/moderation/statistics**
Получить статистику модерации

**Response:**
```json
{
  "total": 10,
  "pending": 5,
  "approved": 3,
  "rejected": 2
}
```

#### **GET /api/presentations/approved**
Получить только одобренные доклады

### 5. Страница модерации (/moderation)
- Статистика докладов (всего, на модерации, одобрено, отклонено)
- Вкладки: "На модерации" и "Все доклады"
- Для каждого доклада на модерации:
  - Информация о докладе и докладчике
  - Поле для комментария
  - Кнопки "Одобрить" / "Отклонить"
- История модерации для обработанных докладов

### 6. Обновления в интерфейсе
- Список докладов показывает только **одобренные** доклады
- Добавлена ссылка "Модерация" в навигационное меню
- Бейджи статуса докладов с цветовой индикацией

## Как использовать:

### Шаг 1: Создать модератора

Зарегистрируйте участника с ролью `Moderator`:

```http
POST /api/participants/register
Content-Type: application/json

{
  "firstName": "Иван",
  "lastName": "Модератор",
  "middleName": "Иванович",
  "workPlace": "Оргкомитет",
  "email": "moderator@conference.ru",
  "phone": "+79991234567",
  "role": 3
}
```

Запомните `id` созданного модератора из ответа.

### Шаг 2: Модерировать доклады

1. Откройте страницу `/moderation`
2. Введите ID модератора в поле "ID модератора"
3. Просмотрите доклады на вкладке "На модерации"
4. Для каждого доклада:
   - При необходимости добавьте комментарий
   - Нажмите "Одобрить" или "Отклонить"

### Шаг 3: Просмотр результатов

- **Одобренные доклады** отображаются на странице `/conference/presentations`
- **Отклонённые доклады** видны только на странице модерации
- **Статистика** отображается в верхней части страницы модерации

## Workflow регистрации докладов:

1. **Докладчик регистрируется** с докладом ? Статус: `Pending`
2. **Модератор просматривает** доклад на `/moderation`
3. **Модератор принимает решение**:
   - Одобрить ? Статус: `Approved` ? Доклад появляется в публичном списке
   - Отклонить ? Статус: `Rejected` ? Доклад скрыт из публичного списка

## База данных

Миграция `20251025183107_AddModerationFeature` добавляет:
- Поле `Status` (int, NOT NULL, по умолчанию 0 = Pending)
- Поле `ModeratedBy` (int, NULL)
- Поле `ModerationDate` (datetime2, NULL)
- Поле `ModerationComment` (nvarchar(500), NULL)
- Индекс на `ModeratedBy`
- Внешний ключ `FK_Presentations_Participants_ModeratedBy`

## Примечания:

1. **Автоматическая установка статуса**: Все новые доклады автоматически получают статус `Pending`
2. **Защита**: Модерировать могут только участники с ролью `Moderator`
3. **История**: Сохраняется информация о том, кто, когда и с каким комментарием модерировал доклад
4. **Фильтрация**: Публичный список показывает только одобренные доклады

## Тестирование:

### 1. Создать модератора через Postman/Swagger:
```
POST http://localhost:5129/api/participants/register
```

### 2. Зарегистрировать докладчика с докладом через интерфейс:
- Перейти на `/conference/register`
- Заполнить форму
- Выбрать роль "Докладчик"

### 3. Промодерировать доклад:
- Перейти на `/moderation`
- Ввести ID модератора
- Одобрить или отклонить доклад

### 4. Проверить результат:
- Открыть `/conference/presentations`
- Должны отображаться только одобренные доклады
